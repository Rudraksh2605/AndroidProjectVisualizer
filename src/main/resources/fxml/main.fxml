<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.Menu?>
<?import javafx.scene.control.MenuBar?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.control.ProgressIndicator?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.SeparatorMenuItem?>
<?import javafx.scene.control.SplitPane?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.control.TreeView?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Priority?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.Circle?>
<?import org.controlsfx.control.StatusBar?>
<?import javafx.scene.control.MenuButton?>

<VBox xmlns="http://javafx.com/javafx/11.0.1"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.projectvisualizer.controllers.MainController"
      stylesheets="@/styles/styles.css"
      spacing="0"
      fx:id="mainContainer"
      styleClass="root">

    <!-- Menu Bar -->
    <MenuBar styleClass="app-menu-bar">
        <Menu text="File">
            <MenuItem text="Open Project..." onAction="#handleOpenProject" accelerator="Ctrl+O"/>
            <MenuItem text="Recent Projects" disable="true"/>
            <SeparatorMenuItem/>
            <Menu text="Export Diagram...">
                <MenuItem text="Enhanced PlantUML..." onAction="#handleExportEnhancedDiagram"/>
                <MenuItem text="Enhanced Graphviz..." onAction="#handleExportEnhancedDiagram"/>
                <SeparatorMenuItem/>
                <MenuItem text="PNG Image..." onAction="#handleExportDiagram"/>
                <MenuItem text="JPEG Image..." onAction="#handleExportDiagram"/>
            </Menu>
            <MenuItem text="Export Report..." onAction="#handleExportReport" accelerator="Ctrl+R"/>
            <SeparatorMenuItem/>
            <MenuItem text="Settings..." onAction="#handleSettings" accelerator="Ctrl+,"/>
            <SeparatorMenuItem/>
            <MenuItem text="Exit" onAction="#handleExit" accelerator="Ctrl+Q"/>
        </Menu>
        <Menu text="View">
            <MenuItem text="Zoom In" onAction="#handleZoomIn" accelerator="Ctrl+Plus"/>
            <MenuItem text="Zoom Out" onAction="#handleZoomOut" accelerator="Ctrl+Minus"/>
            <MenuItem text="Reset Zoom" onAction="#handleResetZoom" accelerator="Ctrl+0"/>
            <MenuItem text="Fit to Window" onAction="#handleFitToWindow" accelerator="Ctrl+F"/>
            <SeparatorMenuItem/>
            <MenuItem text="Project Documentation" onAction="#handleViewProjectDocs" accelerator="Ctrl+D"/>
        </Menu>
        <Menu text="Help">
            <MenuItem text="Documentation" onAction="#handleShowDocumentation" accelerator="F1"/>
            <SeparatorMenuItem/>
            <MenuItem text="About" onAction="#handleShowAbout"/>
        </Menu>
    </MenuBar>

    <!-- Main Content -->
    <SplitPane dividerPositions="0.22" VBox.vgrow="ALWAYS" styleClass="main-split">
        
        <!-- Left Sidebar -->
        <VBox styleClass="sidebar" minWidth="280" maxWidth="400">
            
            <!-- Project Structure -->
            <VBox styleClass="sidebar-section" VBox.vgrow="ALWAYS">
                <HBox styleClass="section-header" alignment="CENTER_LEFT">
                    <Label text="PROJECT STRUCTURE" styleClass="section-title"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button text="â†»" styleClass="icon-btn" onAction="#handleRefreshTree">
                        <tooltip><Tooltip text="Refresh"/></tooltip>
                    </Button>
                </HBox>
                <TreeView fx:id="projectTreeView" VBox.vgrow="ALWAYS" styleClass="project-tree"/>
            </VBox>

            <!-- Components -->
            <VBox styleClass="sidebar-section" VBox.vgrow="SOMETIMES" minHeight="180">
                <HBox styleClass="section-header" alignment="CENTER_LEFT">
                    <Label text="COMPONENTS" styleClass="section-title"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button text="Reset" styleClass="small-btn" onAction="#handleResetToFullView"/>
                </HBox>
                <ListView fx:id="componentsListView" VBox.vgrow="ALWAYS" styleClass="component-list"/>
            </VBox>
        </VBox>

        <!-- Right Content Area -->
        <VBox styleClass="content-area" HBox.hgrow="ALWAYS">
            
            <!-- Compact Toolbar -->
            <HBox styleClass="toolbar" alignment="CENTER_LEFT" spacing="16">
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label text="Level:" styleClass="toolbar-lbl"/>
                    <ComboBox fx:id="abstractionLevelComboBox" value="High Level" styleClass="toolbar-dropdown" prefWidth="120"/>
                </HBox>
                
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label text="Mode:" styleClass="toolbar-lbl"/>
                    <ComboBox fx:id="visualizationModeComboBox" value="Technical Architecture" styleClass="toolbar-dropdown" prefWidth="160"/>
                </HBox>
                
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label text="Feature:" styleClass="toolbar-lbl"/>
                    <ComboBox fx:id="featureFilterComboBox" value="All Features" styleClass="toolbar-dropdown" prefWidth="130"/>
                </HBox>

                <Region HBox.hgrow="ALWAYS"/>

                <HBox alignment="CENTER_LEFT" spacing="8">
                    <MenuButton fx:id="viewModeMenuButton" text="View" styleClass="toolbar-dropdown"/>
                    <Label fx:id="categoryStatsLabel" text="" styleClass="stats-label"/>
                </HBox>
                
                <Separator orientation="VERTICAL" styleClass="toolbar-sep"/>
                
                <HBox alignment="CENTER" spacing="4">
                    <Button text="âˆ’" styleClass="zoom-btn" onAction="#handleZoomOut"/>
                    <Label fx:id="zoomLabel" text="100%" styleClass="zoom-lbl" minWidth="50" alignment="CENTER"/>
                    <Button text="+" styleClass="zoom-btn" onAction="#handleZoomIn"/>
                    <Button text="âŒ‚" styleClass="zoom-btn" onAction="#handleFitToWindow">
                        <tooltip><Tooltip text="Fit to Window"/></tooltip>
                    </Button>
                </HBox>
            </HBox>

            <!-- Tab Content -->
            <TabPane fx:id="visualizationTabPane" VBox.vgrow="ALWAYS" styleClass="main-tabs" tabClosingPolicy="UNAVAILABLE">
                
                <Tab text="Architecture" styleClass="main-tab">
                    <StackPane styleClass="tab-body">
                        <ScrollPane fx:id="diagramScrollPane" styleClass="diagram-pane"/>
                    </StackPane>
                </Tab>

                <Tab text="Dependencies" styleClass="main-tab">
                    <VBox styleClass="tab-body" spacing="16">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <Label text="Dependencies Analysis" styleClass="tab-heading"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <ComboBox value="All Dependencies" styleClass="filter-dropdown"/>
                        </HBox>
                        <ScrollPane VBox.vgrow="ALWAYS" fitToWidth="true">
                            <VBox fx:id="dependenciesContainer" spacing="12" styleClass="dep-container"/>
                        </ScrollPane>
                    </VBox>
                </Tab>

                <Tab text="Statistics" styleClass="main-tab">
                    <VBox styleClass="tab-body" spacing="16">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <Label text="Project Statistics" styleClass="tab-heading"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="Copy" styleClass="action-btn"/>
                            <Button text="Export" styleClass="action-btn"/>
                        </HBox>
                        <ScrollPane VBox.vgrow="ALWAYS" fitToWidth="true">
                            <VBox fx:id="statisticsContainer" spacing="16" styleClass="stats-container"/>
                        </ScrollPane>
                    </VBox>
                </Tab>

                <Tab text="ðŸ“‹ Project Docs" fx:id="projectDocsTab" styleClass="main-tab">
                    <VBox styleClass="tab-body" spacing="0">
                        <HBox alignment="CENTER_LEFT" spacing="12" styleClass="tab-header-bar">
                            <Label text="Generated Project Documentation" styleClass="tab-heading"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="projectDocsStatusLabel" text="Load a project to generate docs" styleClass="status-hint"/>
                        </HBox>
                        <ScrollPane VBox.vgrow="ALWAYS" fitToWidth="true" styleClass="doc-scroll">
                            <VBox fx:id="projectDocsContainer" spacing="24" styleClass="doc-container"/>
                        </ScrollPane>
                    </VBox>
                </Tab>

                <Tab text="PlantUML" styleClass="main-tab">
                    <VBox styleClass="tab-body" spacing="12">
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label text="PlantUML Code" styleClass="tab-heading"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="Copy" styleClass="action-btn" onAction="#handleCopyPlantUML"/>
                            <Button text="Save" styleClass="action-btn" onAction="#handleExportToPlantUML"/>
                        </HBox>
                        <TextArea fx:id="plantUMLTextArea" VBox.vgrow="ALWAYS" styleClass="code-area" editable="false"/>
                    </VBox>
                </Tab>

                <Tab text="Graphviz" styleClass="main-tab">
                    <VBox styleClass="tab-body" spacing="12">
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label text="Graphviz Code" styleClass="tab-heading"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="Copy" styleClass="action-btn" onAction="#handleCopyGraphviz"/>
                            <Button text="Save" styleClass="action-btn" onAction="#handleExportToGraphviz"/>
                        </HBox>
                        <TextArea fx:id="graphvizTextArea" VBox.vgrow="ALWAYS" styleClass="code-area" editable="false"/>
                    </VBox>
                </Tab>

                <Tab text="PlantUML Preview" fx:id="plantUMLImageTab" styleClass="main-tab">
                    <VBox spacing="0">
                        <HBox styleClass="preview-toolbar" alignment="CENTER_LEFT" spacing="8">
                            <Button text="Zoom In" styleClass="action-btn" onAction="#handleZoomInPlantUML"/>
                            <Button text="Zoom Out" styleClass="action-btn" onAction="#handleZoomOutPlantUML"/>
                            <Button text="Reset" styleClass="action-btn" onAction="#handleResetZoomPlantUML"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="Export Image" styleClass="primary-btn" onAction="#handleExportPlantUMLImage"/>
                        </HBox>
                        <ScrollPane VBox.vgrow="ALWAYS" pannable="true">
                            <StackPane><ImageView fx:id="plantUMLImageView"/></StackPane>
                        </ScrollPane>
                    </VBox>
                </Tab>

                <Tab text="Graphviz Preview" fx:id="graphvizImageTab" styleClass="main-tab">
                    <VBox spacing="0">
                        <HBox styleClass="preview-toolbar" alignment="CENTER_LEFT" spacing="8">
                            <Button text="Zoom In" styleClass="action-btn" onAction="#handleZoomInGraphviz"/>
                            <Button text="Zoom Out" styleClass="action-btn" onAction="#handleZoomOutGraphviz"/>
                            <Button text="Reset" styleClass="action-btn" onAction="#handleResetZoomGraphviz"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="Export Image" styleClass="primary-btn" onAction="#handleExportGraphvizImage"/>
                        </HBox>
                        <ScrollPane VBox.vgrow="ALWAYS" pannable="true">
                            <StackPane><ImageView fx:id="graphvizImageView"/></StackPane>
                        </ScrollPane>
                    </VBox>
                </Tab>

                <Tab text="ðŸ“– Documentation" fx:id="documentationTab" styleClass="main-tab">
                    <VBox styleClass="tab-body" spacing="0">
                        <ScrollPane VBox.vgrow="ALWAYS" fitToWidth="true" styleClass="doc-scroll">
                            <VBox fx:id="documentationContainer" spacing="24" styleClass="doc-container">
                                <!-- Documentation content will be populated by controller -->
                            </VBox>
                        </ScrollPane>
                    </VBox>
                </Tab>
            </TabPane>
        </VBox>
    </SplitPane>

    <!-- Status Bar -->
    <StatusBar fx:id="statusBar" styleClass="app-status-bar">
        <leftItems>
            <HBox spacing="12" alignment="CENTER_LEFT">
                <Label fx:id="statusLabel" text="Ready" styleClass="status-text"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="projectInfoLabel" text="" styleClass="status-info"/>
            </HBox>
        </leftItems>
        <rightItems>
            <HBox spacing="12" alignment="CENTER_RIGHT">
                <HBox fx:id="progressContainer" spacing="6" alignment="CENTER_RIGHT" visible="false" managed="false">
                    <ProgressIndicator fx:id="analysisProgressIndicator" prefWidth="14" prefHeight="14"/>
                    <Label fx:id="progressLabel" text="Analyzing..." styleClass="progress-lbl"/>
                </HBox>
                <Label fx:id="memoryLabel" text="Memory: 0 MB" styleClass="status-info"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="statusZoomLabel" text="100%" styleClass="status-info"/>
                <HBox spacing="6" alignment="CENTER">
                    <Circle fx:id="connectionStatusIndicator" radius="4" fill="#4ade80"/>
                    <Label text="Ready" styleClass="status-info"/>
                </HBox>
            </HBox>
        </rightItems>
    </StatusBar>
</VBox>
