<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.CheckBox?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.Menu?>
<?import javafx.scene.control.MenuBar?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.control.ProgressIndicator?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.SeparatorMenuItem?>
<?import javafx.scene.control.SplitPane?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.control.TreeView?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.Circle?>
<?import org.controlsfx.control.StatusBar?>

<VBox xmlns="http://javafx.com/javafx/11.0.1"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.projectvisualizer.controllers.MainController"
      stylesheets="@/styles/styles.css"
      spacing="0"
      fx:id="mainContainer">

    <!-- Enhanced Menu Bar with Modern Styling -->
    <MenuBar>
        <!-- Enhanced Export Options -->
        <Menu text="File" mnemonicParsing="false">
            <MenuItem text="Open Project..." mnemonicParsing="false"
                      onAction="#handleOpenProject"
                      accelerator="Ctrl+O"/>
            <MenuItem text="Recent Projects" mnemonicParsing="false"
                      disable="true"/>
            <SeparatorMenuItem/>

            <!-- Enhanced Export Options -->
            <Menu text="Export Diagram...">
                <MenuItem text="Enhanced PlantUML..." mnemonicParsing="false"
                          onAction="#handleExportEnhancedDiagram"/>
                <MenuItem text="Enhanced Graphviz..." mnemonicParsing="false"
                          onAction="#handleExportEnhancedDiagram"/>
                <SeparatorMenuItem/>
                <MenuItem text="PNG Image..." mnemonicParsing="false"
                          onAction="#handleExportDiagram"/>
                <MenuItem text="JPEG Image..." mnemonicParsing="false"
                          onAction="#handleExportDiagram"/>
                <SeparatorMenuItem/>
                <MenuItem text="Legacy Export..." mnemonicParsing="false"
                          onAction="#handleExportDiagram"/>
            </Menu>

            <MenuItem text="Export Report..." mnemonicParsing="false"
                      onAction="#handleExportReport"
                      accelerator="Ctrl+R"/>
            <SeparatorMenuItem/>
            <MenuItem text="Settings..." mnemonicParsing="false"
                      onAction="#handleSettings"
                      accelerator="Ctrl+,"/>
            <SeparatorMenuItem/>
            <MenuItem text="Exit" mnemonicParsing="false"
                      onAction="#handleExit"
                      accelerator="Ctrl+Q"/>
        </Menu>



        <!-- Enhanced View Menu -->
        <Menu text="View" mnemonicParsing="false">
            <MenuItem text="Zoom In" mnemonicParsing="false"
                      onAction="#handleZoomIn"
                      accelerator="Ctrl+Plus"/>
            <MenuItem text="Zoom Out" mnemonicParsing="false"
                      onAction="#handleZoomOut"
                      accelerator="Ctrl+Minus"/>
            <MenuItem text="Reset Zoom" mnemonicParsing="false"
                      onAction="#handleResetZoom"
                      accelerator="Ctrl+0"/>
            <MenuItem text="Fit to Window" mnemonicParsing="false"
                      onAction="#handleFitToWindow"
                      accelerator="Ctrl+F"/>
            <SeparatorMenuItem/>

            <SeparatorMenuItem/>

        </Menu>
    </MenuBar>

    <!-- Enhanced Main Content Area -->
    <SplitPane dividerPositions="0.25" VBox.vgrow="ALWAYS" styleClass="main-split-pane">
        <VBox spacing="0" styleClass="sidebar-panel">
            <!-- Project Structure Section -->
            <VBox spacing="0" styleClass="sidebar-section">
                <HBox styleClass="panel-header" alignment="CENTER_LEFT" spacing="10">
                    <Label text="Project Structure" styleClass="panel-title"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button text="âŸ³" styleClass="icon-button"
                            onAction="#handleRefreshTree">
                        <tooltip>
                            <Tooltip text="Refresh Project Tree"/>
                        </tooltip>
                    </Button>
                    <Button text="Reset to Full View" onAction="#handleResetToFullView" />
                </HBox>

                <TreeView fx:id="projectTreeView" VBox.vgrow="ALWAYS"
                          styleClass="modern-tree"/>
            </VBox>

            <!-- Components List Section -->
            <VBox spacing="0" styleClass="sidebar-section">
                <HBox styleClass="panel-header" alignment="CENTER_LEFT" spacing="10">
                    <Label text="Components" styleClass="panel-title"/>
                    <Region HBox.hgrow="ALWAYS"/>
                </HBox>
                <ListView fx:id="componentsListView" VBox.vgrow="ALWAYS"
                          styleClass="modern-list"/>
            </VBox>
        </VBox>

        <!-- Main Visualization Area -->
        <VBox spacing="0" styleClass="main-content-area">
            <!-- Enhanced Toolbar with Abstraction Level Controls -->
            <HBox styleClass="graph-toolbar" alignment="CENTER_LEFT" spacing="12">
                <Separator orientation="VERTICAL"/>

                <!-- NEW: Abstraction Level Controls -->
                <VBox spacing="4">
                    <Label text="Detail Level:" styleClass="toolbar-label"/>
                    <ComboBox fx:id="abstractionLevelComboBox"
                              value="High Level"
                              styleClass="toolbar-combo">
                        <tooltip>
                            <Tooltip text="Select visualization detail level"/>
                        </tooltip>
                    </ComboBox>
                </VBox>

                <Separator orientation="VERTICAL"/>

                <!-- Visualization Mode Controls -->
                <VBox spacing="4">
                    <Label text="Mode:" styleClass="toolbar-label"/>
                    <ComboBox fx:id="visualizationModeComboBox"
                              value="Technical Architecture"
                              styleClass="toolbar-combo">
                        <tooltip>
                            <Tooltip text="Select visualization mode"/>
                        </tooltip>
                    </ComboBox>
                </VBox>

                <Separator orientation="VERTICAL"/>

                <!-- NEW: Feature Filter -->
                <VBox spacing="4">
                    <Label text="Feature:" styleClass="toolbar-label"/>
                    <ComboBox fx:id="featureFilterComboBox"
                              value="All Features"
                              styleClass="toolbar-combo">
                        <tooltip>
                            <Tooltip text="Filter by feature"/>
                        </tooltip>
                    </ComboBox>
                </VBox>

                <Separator orientation="VERTICAL"/>

                <!-- Zoom Controls -->
                <VBox spacing="4">
                    <Label text="Zoom:" styleClass="toolbar-label"/>
                    <HBox spacing="4" alignment="CENTER_LEFT">
                        <Button text="âˆ’" styleClass="zoom-button"
                                onAction="#handleZoomOut">
                            <tooltip>
                                <Tooltip text="Zoom Out (Ctrl+-)"/>
                            </tooltip>
                        </Button>
                        <Label fx:id="zoomLabel" text="100%"
                               styleClass="zoom-label"
                               minWidth="45"
                               alignment="CENTER"/>
                        <Button text="+" styleClass="zoom-button"
                                onAction="#handleZoomIn">
                            <tooltip>
                                <Tooltip text="Zoom In (Ctrl++)"/>
                            </tooltip>
                        </Button>
                        <Button text="âŒ‚" styleClass="zoom-button"
                                onAction="#handleFitToWindow">
                            <tooltip>
                                <Tooltip text="Fit to Window (Ctrl+F)"/>
                            </tooltip>
                        </Button>
                    </HBox>
                </VBox>
            </HBox>

                <Separator orientation="VERTICAL"/>

            <TabPane fx:id="visualizationTabPane" VBox.vgrow="ALWAYS"
                     styleClass="modern-tab-pane"
                     tabClosingPolicy="UNAVAILABLE">

                <!-- Architecture Diagram Tab -->
                <Tab text="ðŸ— Architecture" styleClass="diagram-tab">
                    <StackPane styleClass="tab-content">
                        <ScrollPane fx:id="diagramScrollPane"
                                    styleClass="diagram-scroll-pane"
                                    StackPane.alignment="CENTER">
                        </ScrollPane>
                    </StackPane>
                </Tab>


                <!-- Dependencies Tab -->
                <Tab text="ðŸ”— Dependencies">
                    <VBox styleClass="tab-content dependencies-tab">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <Label text="Dependencies Analysis" styleClass="tab-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <ComboBox promptText="Show..."
                                      value="All Dependencies"
                                      styleClass="filter-combo">
                            </ComboBox>
                        </HBox>

                        <ScrollPane VBox.vgrow="ALWAYS"
                                    styleClass="dependencies-scroll">
                            <VBox fx:id="dependenciesContainer"
                                  spacing="12"
                                  styleClass="dependencies-container"/>
                        </ScrollPane>
                    </VBox>
                </Tab>

                <!-- Statistics Tab -->
                <Tab text="ðŸ“Š Statistics">
                    <VBox styleClass="tab-content statistics-tab">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <Label text="Project Statistics" styleClass="tab-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="ðŸ“‹ Copy Report" styleClass="action-button secondary"/>
                            <Button text="ðŸ’¾ Export Report" styleClass="action-button secondary"/>
                        </HBox>

                        <ScrollPane VBox.vgrow="ALWAYS"
                                    fitToWidth="true"
                                    styleClass="statistics-scroll">
                            <VBox fx:id="statisticsContainer"
                                  spacing="16"
                                  styleClass="stats-container"/>
                        </ScrollPane>
                    </VBox>
                </Tab>


                <!-- Added PlantUML and Graphviz Tabs -->
                <Tab text="ðŸŒ¿ PlantUML">
                    <VBox styleClass="tab-content">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="PlantUML Diagram" styleClass="tab-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="Copy Code" onAction="#handleCopyPlantUML"/>
                            <Button text="Save As..." onAction="#handleExportToPlantUML"/>
                        </HBox>
                        <TextArea fx:id="plantUMLTextArea" VBox.vgrow="ALWAYS"
                                  styleClass="code-text-area" editable="false"/>
                    </VBox>
                </Tab>

                <Tab text="ðŸ”„ Graphviz">
                    <VBox styleClass="tab-content">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Graphviz Diagram" styleClass="tab-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="Copy Code" onAction="#handleCopyGraphviz"/>
                            <Button text="Save As..." onAction="#handleExportToGraphviz"/>
                        </HBox>
                        <TextArea fx:id="graphvizTextArea" VBox.vgrow="ALWAYS"
                                  styleClass="code-text-area" editable="false"/>
                    </VBox>
                </Tab>

                <Tab text="PlantUML Image" fx:id="plantUMLImageTab">
                    <VBox spacing="0">
                        <HBox alignment="CENTER_LEFT" styleClass="image-toolbar">
                            <Button text="Zoom In" onAction="#handleZoomInPlantUML"/>
                            <Button text="Zoom Out" onAction="#handleZoomOutPlantUML"/>
                            <Button text="Reset Zoom" onAction="#handleResetZoomPlantUML"/>
                            <Button text="Export Image" onAction="#handleExportPlantUMLImage"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="Export Code" onAction="#handleExportToPlantUML"/>
                        </HBox>
                        <ScrollPane VBox.vgrow="ALWAYS">
                            <ImageView fx:id="plantUMLImageView" fitWidth="800" preserveRatio="true" />
                        </ScrollPane>
                    </VBox>
                </Tab>

                <Tab text="Graphviz Image" fx:id="graphvizImageTab">
                    <VBox spacing="0">
                        <HBox alignment="CENTER_LEFT" styleClass="image-toolbar">
                            <Button text="Zoom In" onAction="#handleZoomInGraphviz"/>
                            <Button text="Zoom Out" onAction="#handleZoomOutGraphviz"/>
                            <Button text="Reset Zoom" onAction="#handleResetZoomGraphviz"/>
                            <Button text="Export Image" onAction="#handleExportGraphvizImage"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="Export Code" onAction="#handleExportToGraphviz"/>
                        </HBox>
                        <ScrollPane VBox.vgrow="ALWAYS">
                            <ImageView fx:id="graphvizImageView" fitWidth="800" preserveRatio="true" />
                        </ScrollPane>
                    </VBox>
                </Tab>
            </TabPane>
        </VBox>
    </SplitPane>

    <!-- Enhanced Status Bar -->
    <StatusBar fx:id="statusBar" styleClass="modern-status-bar">
        <leftItems>
            <HBox spacing="12" alignment="CENTER_LEFT">
                <Label fx:id="statusLabel" text="Ready" styleClass="status-text"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="projectInfoLabel" text="" styleClass="status-info"/>
            </HBox>
        </leftItems>

        <rightItems>
            <HBox spacing="12" alignment="CENTER_RIGHT">
                <!-- Progress indicator -->
                <HBox fx:id="progressContainer"
                      spacing="8"
                      alignment="CENTER_RIGHT"
                      visible="false"
                      managed="false">
                    <ProgressIndicator fx:id="analysisProgressIndicator"
                                       styleClass="loading-spinner"
                                       prefWidth="16"
                                       prefHeight="16"/>
                    <Label fx:id="progressLabel" text="Analyzing..."
                           styleClass="progress-text"/>
                </HBox>

                <!-- Memory usage -->
                <Label fx:id="memoryLabel" text="Memory: 0 MB"
                       styleClass="status-info"/>

                <Separator orientation="VERTICAL"/>

                <!-- Zoom level -->
                <Label fx:id="statusZoomLabel" text="100%"
                       styleClass="status-info"/>

                <!-- Connection status -->
                <HBox spacing="4" alignment="CENTER">
                    <Circle fx:id="connectionStatusIndicator"
                            radius="4"
                            fill="#10b981"/>
                    <Label text="Ready" styleClass="status-info"/>
                </HBox>
            </HBox>
        </rightItems>
    </StatusBar>


</VBox>
